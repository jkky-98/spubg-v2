FROM gradle:8.14-jdk21
WORKDIR /app

# Gradle wrapper 권한 설정
RUN chmod +x ./gradlew || true

# 기본 파일들 복사
COPY build.gradle settings.gradle ./
COPY gradlew ./
COPY gradle ./gradle
RUN chmod +x ./gradlew

# 소스 코드 복사 (초기 빌드용)
COPY src ./src

# 의존성 다운로드 및 초기 빌드 (캐시 활용)
RUN gradle dependencies --no-daemon || true
RUN gradle compileJava --no-daemon || true

EXPOSE 8080

# 개발 모드: gradle bootRun 사용 (핫 리로드)
CMD ["./gradlew", "bootRun", "--no-daemon"]

